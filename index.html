<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>NYT Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<!--    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        
         body { 
              margin: 0;
              font-family: Arial;
              background: linear-gradient(to right, #ffffff, #FCFCFC );         
             }
        
        
        .headerHead{
              font-size: 35px;
              font-weight: bold;
                }

        .header {
              background-color: #f1f1f1;
              padding: 30px 10px ;
              margin-bottom: 25px;
              background-color: black;
              color: darkgray;
              border-bottom: 2px solid blue;
                }
                

        .header-right {
             float: none;
            }
        
         .footer {
/*           position: fixed;*/
/*           left: 0;*/
/*           bottom: 0;*/
               width: 100%;
               background-color: #f2f2f2;
               color: #666666;
               border-top: 1px solid #bfbfbf;
               text-align: center;
               font-family: initial;
               font-size: 20px;
    /*         opacity: 0.1;*/
               clear: both;
               height: 60px;
               margin-bottom: 0;
                }
        
        
        .inputField {
                width: 20%;
                box-sizing: border-box;
                border: 2px solid #ccc;
                border-radius: 4px;
                font-size: 16px;
                background-color: white;
                background-position: 10px 10px; 
                background-repeat: no-repeat;
    /*            padding: 12px 5px 12px 15px;*/
                height: 30px;
        }
        
        #labelYear {
                font-weight: bold;
                margin-left: 20px
        }
        
        #labelMonth {
                font-weight: bold;
        }
        
        
        #input {
/*            border: 1px solid green;*/
                margin-left: 20px;
        }
        
        #year {
                margin-right: 15px;
        }
        
        #month {
                margin-right: 15px;
        }
        
        #button {
                border-radius: 4px;
                border: 2px solid #ccc;
                font-size: 16px;
                width: 10%;
                height: 30px;
                font-weight: bold;
                cursor: pointer;
        }
        
        
        
        #articleTitle {
            text-align: center;
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 5px;
        }
        
        #articlePicture {
            width: 100px;
            border-radius: 8px;
            margin-bottom: 2px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            height: auto;
        }
        
        #articleDescription {
    /*            text-overflow: ellipsis;*/
    /*            text-align: center;*/
                border: 1px solid orange;
    /*            height: 90px;*/
    /*            text-overflow: ellipsis;*/
    /*            overflow: inherit;*/
    /*            width: 100%;*/
    /*            padding: 5px;*/
                font-size: 13px;
    /*            display: block;*/
                display: -webkit-box;
                /* max-width: 200px; */
                -webkit-line-clamp: 5;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                padding-left: 5px;
                padding-top: 5px;
                padding-right: 5px;

            }
        
/*
        #articleUrl{
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
*/
        
    
        .container {
                float: left;
                width: 70%;
                border: 2px solid red;
                padding: 10px;
                margin: 20px;
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(5, 250px);
            }     
        
        .article {
                border: 1px solid black;
                margin: 2px;
                overflow: hidden;
             /* overflow-wrap: break-word;*/
                 }
        
        
        
        .details{
            float: left;
/*            width: 300px;*/
            width: 20%;
/*            height: 500px;*/
/*            color: #000099;*/
/*            font-weight: bold;*/
            margin-top: 20px;
            border: 2px solid green;
            overflow-wrap: break-word;
            line-height: 1.8;
        }
        
        b {
            color: #000099;
        }
        
        a:hover {
            color: #4d94ff;
}
        
        
                @media only screen and (max-width: 768px) {
                        /* For tablet: */
                            .container {
                /*            float: left;*/
                            width: 90%;
                            border: 2px solid red;
                            padding: 10px;
                            display: grid;
                            grid-template-columns: repeat(2, 1fr);
                            grid-template-rows: repeat(10, 250px);


                   }

                            .details{
                                border: 2px solid green;
                                width: 90%;
                                padding: 10px;
                                margin-left: 20px;
                                margin-bottom: 10px;

                                  }
                                     }     

                @media only screen and (max-width: 668px) {
                    /* For mobile: */
                            .container {
                /*                float: left;*/
                                width: 85%;
                                border: 2px solid red;
                                padding: 10px;
                                display: grid;
                                grid-template-columns: repeat(1, 1fr);
                                grid-template-rows: repeat(1, 250px);
                           }

                            .details{
                                border: 2px solid green;
                                width: 85%;
                                 padding: 10px;
                                margin-left: 20px;
                                margin-right: 20px;
                                margin-bottom: 10px;
                            }

                            #year {
                               margin-left: 12px;
                               margin-bottom: 10px;
                                 }

                             #input {
                                width: 250px;
                                   }

                            #labelMonth {
                                position: relative;
                                display: block;
                                margin-left: 20px;
                                width: 800px;
                                
                                 }

                            #labelYear {
                                position: relative;
                                display: block;
                                margin-left: 20px;
                                width: 800px;
                               
                                }

                            #button {
                                width: 80px;
                                margin-left: 115px;
                                margin-top: 10px;
                                
                                  }
                        }

       
    </style>
</head>

<body>
    <div class="header">
        <div class="headerHead">New York Times Explorer</div>
        <div class="">Search New York Times articles since 1851.</div>
    </div>
      
    <div id="root"></div>
    
    <script type="text/babel">
      class App extends React.Component {
        
        constructor(props){
              super(props);
              this.state = {'articles': [], 
                            'year': '1851',
                            'month': '1', 
                             selectedArticle: {
                                   byline: {original: ''},
                                   headline: {main: '',},
                                   word_count: '',
                                   pub_date: '',
                                   web_url: '',
                                   snippet: '',
                         } 
                             
                           };
              this.onSuccess = this.onSuccess.bind(this);
              this.handleChangeYear = this.handleChangeYear.bind(this);
              this.handleChangeMonth = this.handleChangeMonth.bind(this);
              this.handleFind = this.handleFind.bind(this);            
              this.handleArticleDetails = this.handleArticleDetails.bind(this);
             
            }
           handleArticleDetails(item){
                console.log(item)
                console.log("Hello from handleTableRowClick!");
                console.log(JSON.stringify(item));
                this.setState({selectedArticle: item});
                               
            }
         
           handleChangeYear(event) {
//                  debugger;
                  this.setState({year: event.target.value});
//                  console.log(this.state.year)
      }
          
           handleChangeMonth(event) {
                  this.setState({month: event.target.value}); 
      }
          
           handleFind(event){
                   event.preventDefault();
                   if(this.state.year == 1851 &&  this.state.month < 9){
                       return alert('You can search articles only from september 1851.')
                   }
                   if(this.state.year == new Date().getFullYear() && this.state.month > new Date().getMonth()){
                       return alert("You can't serch articles from the future")
                   }
                       
                   

                   $.ajax({
                      url: "https://api.nytimes.com/svc/archive/v1/" + this.state.year + "/" + this.state.month + ".json",  
                      method: 'GET',
                      data: {
                          'api-key': "9b98b8d3102b4c98b7c14e81de2e368e"
              },
                    success: this.onSuccess
              
          });
              }
          
        onSuccess(responseData) {
                  let articles = [];
                  console.log(articles)
                  for(var i = 0; i < 20; i++) {
                    const doc = responseData.response.docs[i];
                      console.log(doc)
                    articles.push(doc);
                  }
                  this.setState({'articles': articles});
                }
          
          
        componentDidUpdate(prevProps, prevState){
                 console.log('componentDidUpdate')  

                 if(!this.state.year || !this.state.month){
                      return
                  }    

                 const oy = prevState.year
                 const om = prevState.month

                 const ny = this.state.year
                 const nm = this.state.month

                 if(oy == ny && om == nm) {
                     return
                 }

                console.log('AJAX')      
             }
          
         years() {
               let start = 1851;
               let end = new Date().getFullYear();
               let years = [];
                  for(var year = start ; year <=end; year++){
                      years.push(year); 
                   }    
                return years;
                } 
          
        render(){
            
           console.log('render')    
            
           return(
               <form onSubmit = {this.handleFind}>
                  
                    <label id = "labelYear">
                        
                        Year: <select id = 'year' className = 'inputField' onChange = {this.handleChangeYear}>;
                             { this.years().map(
                                (year) =>  <option value={year} key={year}>{year}</option>
                                )} 
                        </select>
       
                    </label>

                    <label id = "labelMonth">
                        Month: <select id = 'month' className = 'inputField'  value={this.state.month}  onChange = {this.handleChangeMonth}>
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option> 
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>   
                              </select>
                    </label> 

                    <input type="submit" value="Find" id = "button"  />            

                    <div> 
                        {<Articles articles={this.state.articles} selectionHandler={this.handleArticleDetails} />} 
                    </div>

                    <div className = "details">
                             <ArticleDetails article={this.state.selectedArticle}/>
                    </div>
                       
               </form> 
         // return <Urls data={this.state.urls}/>;
               )
        }
      }


        const ArticleDetails = (props) => {
                    const article = props.article;
                    console.log(article);
                    return (
                        <div>
                            <ul>
                                <li> <b>Headline:</b> {article.headline ? article.headline.main : ""}</li>
                                <li> <b>Snippet:</b> {article.snippet}</li>
                                <li> <b>By:</b> {article.byline ? article.byline.original : "" }</li>
                                <li> <b>Word count:</b> {article.word_count}</li>
                                <li> <b>Date:</b> {article.pub_date}</li>
                                <li> <b>Url:</b> <a href = {article.web_url} target="_blank" > {article.web_url} </a></li>
                            </ul>
                        </div>
                    );
                }
        
 
 
          function Articles(props){
                return (
                  <div className = "container"> 
                    {
                      props.articles.map(
                        (article, index) => <Article key={index} article={article} clickHandler={props.selectionHandler} />
                      )
                    }
                  </div>
                );
              }

    


      class Article extends React.Component{
               constructor(props){
                  super(props);
                  this.state = {
                      title: '',
                      description: '',
                      image: '',
                     // url: ''
                  };

                  this.onSuccess = this.onSuccess.bind(this);
            }
          
          
                onSuccess(responseData){
                    console.log(responseData)
                    let title = responseData.title;
                    let description = responseData.description;
                    let image = responseData.image;
                    //let url = responseData.url;
                    this.setState({'title': title, 'description': description, 'image': image});

                }
          
//                componentDidMount(){
//                      console.log(this.props.article.web_url)
//                      $.ajax({
//                          url: 'http://api.linkpreview.net',  
//                          method: 'GET',
//                          data: {
//                              'key': "5a8de33f3e9b1a8c4c731ee7934db1530bd8866afdc48",
//                              'q': this.props.article.web_url
//                          },
//                          success: this.onSuccess
//                      });
//                    }
//          
        componentDidMount(){
            
            console.log(this.props.article.web_url)
          $.ajax({
              url: 'http://api.linkpreview.net',  
              method: 'GET',
              data: {
                  'key': "123456",
                  'q': 'https://www.google.com'
              },
              success: this.onSuccess
          });
        }
          
                render(){
                      const clickHandler = this.props.clickHandler;
                      const article = this.props.article;

                      const tr = 

                            <div className="article">
                                <div id = "articleTitle" onClick={() => clickHandler(article)} >{this.state.title} </div>
                                <div><img id = "articlePicture"  src={this.state.image} onClick={() => clickHandler(article)}/></div>
                                <div id = "articleDescription" onClick={() => clickHandler(article)} >{this.state.description}</div>                          

                            </div>;

                      console.log(tr)
                      return tr;
                }
            }

      
        const root = document.getElementById('root');   
        ReactDOM.render(<App />,  root);
      
    </script>
    
         <div class="footer">
                <p>Developed by VS</p>
         </div>
   
</body>

</html>